from pywinauto import Desktop
import time
import pyautogui
import re

def get_relative_mouse_pos(window_title):
    # Try two backends
    for backend in ["uia", "win32"]:
        try:
            desktop = Desktop(backend=backend)
            # Try exact match first
            try:
                win = desktop.window(title=window_title)
            except:
                # If that fails, try a regular expression match
                win = desktop.window(title_re=re.escape(window_title)+".*")
            
            rect = win.rectangle()
            print(f"Use {backend} backend to find the window! Position: {rect}")
            break
        except Exception as e:
            print(f"{backend} Backend failed: {str(e)}")
    else:
        print("All backend attempts failed, please check window title")
        return

    try:
        print(f"Please move the mouse to the target location and press Ctrl+C to exit...")
        while True:
            x, y = pyautogui.position()
            rel_x = x - rect.left
            rel_y = y - rect.top
            print(f"Screen coordinates: ({x}, {y}) | Window coordinates: ({rel_x}, {rel_y})", end="\r")
            time.sleep(0.1)
    except KeyboardInterrupt:
        print("\nMeasurement end")

if __name__ == "__main__":
    # Please replace with the actual window title
    get_relative_mouse_pos("QGroundControl")
